<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>milkers image selector</title>
    <script src="js/jquery-1.9.1.min.js"></script>
    <script src="js/jquery.isotope.min.js"></script>
    <script src="js/jquery-isotope-example.js"></script>
    <script src="js/highslide/highslide/highslide.js"></script>
    <script src="js/jquery-1.10.2.min.js"></script>
    <script src="getimages.php"></script>
    <link rel="stylesheet" type="text/css" href="css/jquery-isotope-example.css">
    
  </head>

  <body onload="addElement()">

    <script>
    function displayQueryEmotionResult()
    {
        var query=document.getElementById("query").value;
        var emotion=document.getElementById("emotion").value;
        if (emotion == "neutral") {
            emotion = "";
        }
        else{
            emotion = emotion + "_";
        };
        var finalDir=emotion + query;

        // alert(finalDir);
        // window.location.reload();
        
        return finalDir;
    }
    </script>
    <div id="selectQueryEmotion">
        <form>
        Query:
        <select id="query">
            <option>autumn</option>
            <option>Pear</option>
            <option>Banana</option>
            <option>Orange</option>
        </select>
        Emotion:
        <select id="emotion">
            <option>anger</option>
            <option>anticipation</option>
            <option>happy</option>
            <option>trust</option>
            <option>fear</option>
            <option>surprise</option>
            <option>sadness</option>
            <option>disgust</option>
            <option>neutral</option>
        </select>
        </form>
        <br>
        <button type="button" onclick="window.location.reload()">Select</button>
    </div>
    <br>
    
    <script type="text/javascript">
    var finalDirectory = displayQueryEmotionResult();
    alert("Images are prepared for the query\n=> " + finalDirectory);
    // readAndAddImages(finalDirectory);

    var images = [];
    var userInputNum = 20;//number of images shown to the user.
        
    var orImageSizes = [];

    // pass finalDirectory ro getimages.php file as a parameter.
    // window.location.href = "getimages.php?finalDir=" + finalDirectory;
    // $.post('getimages.php', {'finalDir': finalDirectory});

    var nameList = 'length=' + galleryarray.length + '>> ';
    for (var i = 0; i < 20; i++) {
        nameList = nameList + galleryarray[i] + ' ';    
    };
    alert('ilker: ' +  nameList);

    for (var i = 1; i <= userInputNum; i++) {

        var newDiv = document.createElement("div");
        newDiv.id = "imagediv_"+i;//should define an id for each dynamic div here.        
    
        var tempWidth = 400;//sets the size of each image on the page.
        newDiv.setAttribute("style", "width:"+(tempWidth+10)+"px;height:" +(tempWidth+100)+"px;float:left;border:2px solid;background:#dddddd;");

        images[i] = new Image(); // creates an image
        images[i].class = "image";
        // images[i].src = "userFolders/" + userInputFolder.substring(0,4) + "/" + userInputFolder.substring(4,userInputFolder.length) + "/" + i + ".jpg"; // gets image location from table
        images[i].src = "last_study_data/" + finalDirectory + "/image_" + i + ".jpg"; // gets image location from table

        // images[i].src = "userFolders/" + userInputFolder + "/" + i + ".jpg";
        images[i].name = "image" + "_" + i; // name property of the image.
        orImageSizes[2*i-1] = images[i].width;
        orImageSizes[2*i] = images[i].height;
        
        if (images[i].addEventListener){
            images[i].addEventListener("click", function () { /* Do something */ 
                var nameLength = this.name.length;
                var start = nameLength-5;
                var index = this.name.substring(start,start+1);
                // alert(this.name + ' size is ' + orImageSizes[2*parseInt(index)-1] + ' by ' + orImageSizes[2*parseInt(index)] + ' index=' + index);
                //alert(this.name + ' size is ' + this.width + ' by ' + orImageSizes[2*parseInt(index)] + ' index=' + index);
                alert("This is image " + this.name);
            });
        }
        else if (images[i].attachEvent){ // addEventListener isn't always supported
            images[i].attachEvent("onTouchDown", function () { /* Do something */                 
                alert(images[i].name + " no event listener!");
            });
        }   
        images[i].style.height = tempWidth + "px";
        images[i].style.width = tempWidth + "px";
        images[i].style.marginLeft = (5)+"px"; // pushes images 5 pixels to the left
        images[i].style.marginTop = (5)+"px"; // pushes images 5 pixels to the left
        //document.body.appendChild(images[i]); // append newly created image to body

        var checkIn1 = document.createElement("input");
        checkIn1.type = "checkbox";
        checkIn1.id = "image_"+i+"_cb1";
        var label1 = document.createElement('label');
        label1.htmlFor = "image_"+i+"_cb1";//it should be same with id of checkIn1
        label1.appendChild(document.createTextNode('Relevant'));//relevancy button

        var checkIn2 = document.createElement("input");
        checkIn2.type = "checkbox";
        checkIn2.id = "image_"+i+"_cb2";
        var label2 = document.createElement('label');
        label2.htmlFor = "image_"+i+"_cb2";
        label2.appendChild(document.createTextNode('Emotion'));//emotion exist button

        var checkIn3 = document.createElement("input");
        checkIn3.type = "checkbox";    
        checkIn3.id = "image_"+i+"_cb3";
        var label3 = document.createElement('label');
        label3.htmlFor = "image_"+i+"_cb3";
        label3.appendChild(document.createTextNode('Invalid'));

        //Add single image to newDiv
        newDiv.appendChild(images[i]);

        //Create a 3 x 3 table of choices and add it below image.
        var mytable = document.createElement("table");
        mytable.id = "mytable";
        mytable.style.marginLeft = (10)+"px";

        var tbody = document.createElement("tbody");
        //first row
        var row1 = document.createElement("tr");
        var cell1 = document.createElement("td");
        cell1.appendChild(checkIn1);
        cell1.appendChild(label1);
        var cell2 = document.createElement("td");
        cell2.appendChild(checkIn2);
        cell2.appendChild(label2);
        var cell3 = document.createElement("td");
        cell3.appendChild(checkIn3);
        cell3.appendChild(label3);

        row1.appendChild(cell1);
        row1.appendChild(cell2); 
        row1.appendChild(cell3)
        
        //add all rows to table
        tbody.appendChild(row1);
        mytable.appendChild( tbody );
        newDiv.appendChild( mytable );

        // add the newly created element and its content into the DOM
        my_div = document.getElementById("org_div2");
        document.body.insertBefore(newDiv, my_div);//inserts newDiv before my_div like a stack.
    }//end of for 

    </script>

        
    <div style="overflow:hidden;clear:both;">    
        <div id='org_div2'><br></div>
        <!--button onclick="createResultPage()">Result button</button-->
        <!--input id='finalcheckbox' type="radio" onclick="createResultPage()" /> Please check before submit your result!-->
        <button id='computeresultsbutton' onclick="createResultPage()">Submit your votes!</button>
        <br>
    </div>
    <br><br>

    <script type="text/javascript">
        function createResultPage(){
            //iterate over all checkboxes
            //Create a new resultJson each time user clicks result button.
            //json result collectors.
            var resultData = {};
            var imResults = [];
            resultData.setName = finalDirectory;
            resultData.imResults = imResults;

            // alert("ilker");
            // alert("userInputNum= " + userInputNum);

            for (var i = 1; i <= userInputNum; i++) {

                // check the values of cb1 and cb2
                var relcbx = document.getElementById('image_'+i+'_cb1');
                var emocbx = document.getElementById('image_'+i+'_cb2');
                var invalidcbx = document.getElementById('image_'+i+'_cb3');

                var tempImage = {"imageName":images[i].name, "relevant":0, "emotion":0, "isValid":0};

                // alert(typeof images[i]);

                // here check if image exist?
                if (relcbx.checked) {
                    if (emocbx.checked) {
                        // if an image is both relevant and the emotion exists
                        tempImage = {"imageName":images[i].name, "relevant":1, "emotion":1, "isValid":1};
                    } else{
                        // if an image is relevant but emotion does not exist
                        tempImage = {"imageName":images[i].name, "relevant":1, "emotion":0, "isValid":1};
                    };
                } else{
                    if (invalidcbx.checked) {
                        // if image is not appearing user should select invalid.
                        tempImage = {"imageName":images[i].name, "relevant":0, "emotion":0, "isValid":0}
                    } else{
                        // if image is not relevant, then the existence of emotion is not important
                        tempImage = {"imageName":images[i].name, "relevant":0, "emotion":0, "isValid":1};
                    };
                    
                };

                // push the results of tempImage to resultData json array.
                resultData.imResults.push(tempImage);

            }

            // newwindow=window.open();
            // newdocument=newwindow.document;
            alert("Thank you we saved your result.");   
            document.getElementById('finalResult').value = JSON.stringify(resultData);
            document.getElementById('userfoldername').value = finalDirectory;
            document.getElementById('finalsendbutton').click();
            
            
        }

    </script>

    <div>--</div>

    <form action="mytest.php" method="POST">
        <input type="hidden" name="name" id="userfoldername" />
        <!--Age: <input type="text" name="age" /-->
        <input type="hidden" name="jsonResult" id="finalResult"  />
        <input id="finalsendbutton" type="submit" style="display:none" value="Send Result!" />
    </form>

    <br><br>


  </body>
</html>